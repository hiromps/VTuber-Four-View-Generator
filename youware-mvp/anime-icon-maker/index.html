<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shonen Icon Maker - AIå°‘å¹´ã‚¢ãƒ‹ãƒ¡é¢¨ã‚¢ã‚¤ã‚³ãƒ³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <meta name="description" content="Solo Levelingã€Demon Slayerã€Jujutsu Kaisenãªã©ã®å°‘å¹´ã‚¢ãƒ‹ãƒ¡é¢¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’AIã§ç”Ÿæˆ">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');

        body {
            font-family: 'Noto Sans JP', sans-serif;
        }

        .anime-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .icon-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .icon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .style-button {
            transition: all 0.3s ease;
        }

        .style-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 0 40px rgba(102, 126, 234, 0.8);
            }
        }

        .generating {
            animation: pulse-glow 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="anime-gradient text-white py-8 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl md:text-5xl font-black text-center mb-3">
                âš¡ Shonen Icon Maker
            </h1>
            <p class="text-center text-lg opacity-90">
                å°‘å¹´ã‚¢ãƒ‹ãƒ¡é¢¨ã®ã‚«ãƒƒã‚³ã„ã„ã‚¢ã‚¤ã‚³ãƒ³ã‚’AIã§ç”Ÿæˆ
            </p>
            <p class="text-center text-sm opacity-75 mt-2">
                Solo Levelingãƒ»é¬¼æ»…ã®åˆƒãƒ»å‘ªè¡“å»»æˆ¦ãƒ»ãƒã‚§ãƒ³ã‚½ãƒ¼ãƒãƒ³é¢¨
            </p>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="container mx-auto px-4 py-12 max-w-5xl">

        <!-- ç”Ÿæˆãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-12">

            <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª¬æ˜ -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <span class="bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">1</span>
                    ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’èª¬æ˜
                </h2>
                <textarea
                    id="characterDescription"
                    rows="4"
                    class="w-full border-2 border-gray-300 rounded-lg p-4 focus:border-purple-600 focus:outline-none transition"
                    placeholder="ä¾‹: é»’é«ªã®å°‘å¹´ã€é’ã„ç›®ã€å‰£ã‚’æŒã£ãŸæˆ¦å£«ã€ã‚¯ãƒ¼ãƒ«ãªè¡¨æƒ…ã€ç¨²å¦»ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ"></textarea>
                <p class="text-sm text-gray-600 mt-2">
                    ğŸ’¡ ãƒ’ãƒ³ãƒˆ: é«ªã®è‰²ã€ç›®ã®è‰²ã€è¡¨æƒ…ã€æ­¦å™¨ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãªã©ã‚’å…·ä½“çš„ã«å…¥åŠ›
                </p>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¢ãƒ‹ãƒ¡ã‚¹ã‚¿ã‚¤ãƒ«é¸æŠ -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <span class="bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">2</span>
                    ã‚¢ãƒ‹ãƒ¡ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠ
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button class="style-button active px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-style="solo-leveling">
                        Solo Leveling
                    </button>
                    <button class="style-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-style="demon-slayer">
                        é¬¼æ»…ã®åˆƒ
                    </button>
                    <button class="style-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-style="jujutsu-kaisen">
                        å‘ªè¡“å»»æˆ¦
                    </button>
                    <button class="style-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-style="chainsaw-man">
                        ãƒã‚§ãƒ³ã‚½ãƒ¼ãƒãƒ³
                    </button>
                    <button class="style-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-style="my-hero-academia">
                        åƒ•ã®ãƒ’ãƒ¼ãƒ­ãƒ¼<br>ã‚¢ã‚«ãƒ‡ãƒŸã‚¢
                    </button>
                    <button class="style-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-style="brand-vision">
                        Brand Vision
                    </button>
                    <button class="style-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-style="apothecary-diaries">
                        è–¬å±‹ã®ã²ã¨ã‚Šã”ã¨
                    </button>
                    <button class="style-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-style="generic-shonen">
                        æ±ç”¨å°‘å¹´ã‚¢ãƒ‹ãƒ¡
                    </button>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—3: èƒŒæ™¯ã‚¿ã‚¤ãƒ— -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <span class="bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">3</span>
                    èƒŒæ™¯ã‚¿ã‚¤ãƒ—
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <button class="bg-button active px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-bg="dramatic">
                        ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯
                    </button>
                    <button class="bg-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-bg="solid">
                        å˜è‰²
                    </button>
                    <button class="bg-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-bg="gradient">
                        ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                    </button>
                    <button class="bg-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-bg="action">
                        ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                    </button>
                    <button class="bg-button px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-600 font-bold" data-bg="transparent">
                        ã‚·ãƒ³ãƒ—ãƒ«
                    </button>
                </div>
            </div>

            <!-- ç”Ÿæˆãƒœã‚¿ãƒ³ -->
            <div class="text-center">
                <button
                    id="generateBtn"
                    class="anime-gradient text-white px-12 py-5 rounded-full text-xl font-black shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all duration-300">
                    âš¡ ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆã™ã‚‹
                </button>
                <p class="text-sm text-gray-600 mt-4">
                    ç”Ÿæˆã«ã¯ç´„ 5-10ç§’ ã‹ã‹ã‚Šã¾ã™
                </p>
            </div>
        </div>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
        <div id="loadingArea" class="hidden bg-white rounded-2xl shadow-xl p-8 mb-12">
            <div class="text-center">
                <div class="inline-block animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600 mb-4"></div>
                <h3 class="text-2xl font-bold mb-2">AIãŒç”Ÿæˆä¸­...</h3>
                <p class="text-gray-600" id="loadingMessage">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™</p>
                <div class="mt-6 bg-gray-200 rounded-full h-2 overflow-hidden">
                    <div id="progressBar" class="anime-gradient h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- çµæœè¡¨ç¤º -->
        <div id="resultArea" class="hidden">
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
                <h2 class="text-3xl font-bold mb-6 text-center">âœ¨ ç”Ÿæˆå®Œäº†ï¼</h2>

                <div class="flex justify-center mb-6">
                    <img id="generatedImage" src="" alt="ç”Ÿæˆã•ã‚ŒãŸã‚¢ã‚¤ã‚³ãƒ³" class="rounded-2xl shadow-2xl max-w-full icon-card" style="max-height: 512px;">
                </div>

                <div class="text-center space-y-4">
                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <button id="downloadBtn" class="anime-gradient text-white px-8 py-4 rounded-full font-bold shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all">
                            ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆ1024x1024ï¼‰
                        </button>
                        <button id="regenerateBtn" class="bg-gray-200 text-gray-800 px-8 py-4 rounded-full font-bold hover:bg-gray-300 transition-all">
                            ğŸ”„ åˆ¥ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§å†ç”Ÿæˆ
                        </button>
                    </div>

                    <div class="flex gap-4 justify-center">
                        <button id="shareTwitterBtn" class="bg-blue-500 text-white px-6 py-3 rounded-full font-bold hover:bg-blue-600 transition-all">
                            ğŸ¦ Twitterã§ã‚·ã‚§ã‚¢
                        </button>
                        <button id="copyImageBtn" class="bg-green-500 text-white px-6 py-3 rounded-full font-bold hover:bg-green-600 transition-all">
                            ğŸ“‹ ç”»åƒã‚’ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                </div>

                <!-- ä½¿ç”¨ã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º -->
                <div class="mt-8 p-4 bg-gray-100 rounded-lg">
                    <h3 class="font-bold mb-2">ä½¿ç”¨ã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:</h3>
                    <p id="usedPrompt" class="text-sm text-gray-700"></p>
                </div>
            </div>

            <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆä¾‹ -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h3 class="text-2xl font-bold mb-4">ğŸ’¡ ãƒ—ãƒªã‚»ãƒƒãƒˆä¾‹ã‚’è©¦ã™</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button class="preset-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-600 text-left transition-all" data-preset="shadow-monarch">
                        <div class="font-bold mb-1">ğŸŒ‘ Shadow Monarch</div>
                        <div class="text-sm text-gray-600">é»’é«ªã®å°‘å¹´ã€ç´«ã®ç›®ã€å½±ã®é­”æ³•ã€Solo Levelingé¢¨</div>
                    </button>
                    <button class="preset-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-600 text-left transition-all" data-preset="demon-slayer">
                        <div class="font-bold mb-1">âš”ï¸ é¬¼æ®ºéšŠå‰£å£«</div>
                        <div class="text-sm text-gray-600">æ—¥è¼ªåˆ€ã‚’æŒã£ãŸå‰£å£«ã€æ°´ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã€é¬¼æ»…é¢¨</div>
                    </button>
                    <button class="preset-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-600 text-left transition-all" data-preset="cursed-sorcerer">
                        <div class="font-bold mb-1">ğŸ‘Š å‘ªè¡“å¸«</div>
                        <div class="text-sm text-gray-600">é»’é«ªã€å‘ªåŠ›ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã€ãƒãƒˆãƒ«ãƒãƒ¼ã‚ºã€å‘ªè¡“å»»æˆ¦é¢¨</div>
                    </button>
                    <button class="preset-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-600 text-left transition-all" data-preset="chainsaw-devil">
                        <div class="font-bold mb-1">ğŸªš ãƒ‡ãƒ“ãƒ«ãƒãƒ³ã‚¿ãƒ¼</div>
                        <div class="text-sm text-gray-600">é‡‘é«ªã€ãƒã‚§ãƒ¼ãƒ³ã‚½ãƒ¼ã€æ¿€ã—ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒã‚§ãƒ³ã‚½ãƒ¼ãƒãƒ³é¢¨</div>
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="bg-gray-800 text-white py-8 mt-20">
        <div class="container mx-auto px-4 text-center">
            <p class="mb-2">âš¡ Shonen Icon Maker - Powered by nano-banana (Gemini 2.5 Flash Image)</p>
            <p class="text-sm opacity-75">ä¼šå“¡ç™»éŒ²ä¸è¦ | ç„¡æ–™ã§ä½¿ãˆã‚‹ | é«˜å“è³ªAIç”Ÿæˆ</p>
            <p class="text-xs opacity-50 mt-4">
                â€»ç”Ÿæˆã•ã‚ŒãŸç”»åƒã¯å€‹äººåˆ©ç”¨ãƒ»å•†ç”¨åˆ©ç”¨å¯èƒ½ã§ã™ï¼ˆAIã‚¢ãƒ¼ãƒˆåˆ©ç”¨è¦ç´„ã«æº–ã˜ã¾ã™ï¼‰
            </p>
        </div>
    </footer>

    <script>
        // é¸æŠã•ã‚ŒãŸè¨­å®š
        let selectedStyle = 'solo-leveling';
        let selectedBg = 'dramatic';

        // ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.querySelectorAll('.style-button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.style-button').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedStyle = btn.dataset.style;
            });
        });

        // èƒŒæ™¯ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.querySelectorAll('.bg-button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.bg-button').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedBg = btn.dataset.bg;
            });
        });

        // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const preset = btn.dataset.preset;
                const presets = {
                    'shadow-monarch': {
                        description: 'black-haired young man, purple glowing eyes, shadow magic effects, dark aura, serious expression, mystical energy',
                        style: 'solo-leveling',
                        bg: 'dramatic'
                    },
                    'demon-slayer': {
                        description: 'samurai with nichirin sword, water breathing effects, determined face, traditional uniform, dynamic pose',
                        style: 'demon-slayer',
                        bg: 'action'
                    },
                    'cursed-sorcerer': {
                        description: 'black-haired boy, cursed energy aura, fighting stance, school uniform, intense expression',
                        style: 'jujutsu-kaisen',
                        bg: 'dramatic'
                    },
                    'chainsaw-devil': {
                        description: 'blonde boy with chainsaw, wild expression, blood effects, chaotic energy, aggressive pose',
                        style: 'chainsaw-man',
                        bg: 'action'
                    }
                };

                const selected = presets[preset];
                document.getElementById('characterDescription').value = selected.description;

                // ã‚¹ã‚¿ã‚¤ãƒ«é¸æŠ
                document.querySelectorAll('.style-button').forEach(b => b.classList.remove('active'));
                document.querySelector(`[data-style="${selected.style}"]`).classList.add('active');
                selectedStyle = selected.style;

                // èƒŒæ™¯é¸æŠ
                document.querySelectorAll('.bg-button').forEach(b => b.classList.remove('active'));
                document.querySelector(`[data-bg="${selected.bg}"]`).classList.add('active');
                selectedBg = selected.bg;

                // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });

        // ç”Ÿæˆãƒœã‚¿ãƒ³
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const description = document.getElementById('characterDescription').value.trim();

            if (!description) {
                alert('ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // UIåˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('loadingArea').classList.remove('hidden');
            document.getElementById('resultArea').classList.add('hidden');
            document.getElementById('generateBtn').disabled = true;

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
            let progress = 0;
            const messages = [
                'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™...',
                'nano-banana AIã«é€ä¿¡ä¸­...',
                'ç”»åƒã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...',
                'ã‚‚ã†ã™ãå®Œæˆã§ã™...'
            ];

            const progressInterval = setInterval(() => {
                progress += 5;
                if (progress > 90) progress = 90;
                document.getElementById('progressBar').style.width = progress + '%';

                const messageIndex = Math.floor(progress / 25);
                if (messages[messageIndex]) {
                    document.getElementById('loadingMessage').textContent = messages[messageIndex];
                }
            }, 500);

            try {
                const response = await fetch('/api/generate-icon', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        description: description,
                        style: selectedStyle,
                        background: selectedBg
                    })
                });

                clearInterval(progressInterval);
                document.getElementById('progressBar').style.width = '100%';

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

                const data = await response.json();

                // çµæœè¡¨ç¤º
                document.getElementById('generatedImage').src = data.imageUrl;
                document.getElementById('usedPrompt').textContent = data.prompt;

                document.getElementById('loadingArea').classList.add('hidden');
                document.getElementById('resultArea').classList.remove('hidden');

                // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
                document.getElementById('downloadBtn').onclick = () => {
                    const a = document.createElement('a');
                    a.href = data.imageUrl;
                    a.download = `shonen-icon-${Date.now()}.png`;
                    a.click();
                };

                // å†ç”Ÿæˆãƒœã‚¿ãƒ³
                document.getElementById('regenerateBtn').onclick = () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };

                // Twitterã‚·ã‚§ã‚¢
                document.getElementById('shareTwitterBtn').onclick = () => {
                    const text = encodeURIComponent('Shonen Icon Makerã§å°‘å¹´ã‚¢ãƒ‹ãƒ¡é¢¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼ #ShonenIconMaker #AIã‚¢ãƒ¼ãƒˆ');
                    window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
                };

                // ç”»åƒã‚³ãƒ”ãƒ¼
                document.getElementById('copyImageBtn').onclick = async () => {
                    try {
                        const blob = await fetch(data.imageUrl).then(r => r.blob());
                        await navigator.clipboard.write([
                            new ClipboardItem({ 'image/png': blob })
                        ]);
                        alert('ç”»åƒã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
                    } catch (err) {
                        alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                    }
                };

            } catch (error) {
                clearInterval(progressInterval);
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
                document.getElementById('loadingArea').classList.add('hidden');
            } finally {
                document.getElementById('generateBtn').disabled = false;
            }
        });
    </script>

</body>
</html>
